# 第4章 メソッドと引数

## クラスメソッドはない

特異クラスのインスタンスメソッドだヵら。

```rb
def (Foo = Class.new).bar
  :baz
end
```

これは面白い。それ以外にも色々書けるのかな。実用性はなさそうだけど。

> `class << self` 「Ruby が実際にクラスメソッドを実現する仕組みを表している」

```rb
class << Foo
  def bar
    :baz
  end
end
```

```rb
Foo.instance_eval do
  def bar
    :baz
  end
end
```

```rb
class Foo
  define_singleton_method(:bar) do
    :baz
  end
end

# 普通はこう使うのでは？
Foo.define_singleton_method(:bar) do
  # クロージャなので、外の変数にアクセスできる
end
```

これらはどれもクラスメソッドの定義になる。
`instance_eval` はスコープを作らないので、ブロックがクロージャになっている。

特異クラスの説明がないな〜

## メソッドの命名

> メソッドの命名はRubyにおいて最も重要な命名

ほんとそう。大いに賛成。

> Rubuのコアチームでは良いメソッド名が提案されていないために追加が見送りになっている機能もあり

知らなかった。それほど重要視されているということ。

`p` `pp` については、これを最初に知った時は驚愕だった。Javaから来た人には到底受け入れ難い文化。
脳みそのパラダイムシフトが必要。

`+@` 知らなかったと思って調べたら、`+` 演算子のこと？
演算子 `+` をオーバーライドする際は
```rb
def +@
end
```
と書く必要があるとのこと。
※ C# などの静的型付け言語ではコンパイル時に呼び出すメソッドが決まるので、演算子はオーバーロードしかできない。オーバーライドはできない。

`instance_variable_get` は `iv_get` とはされない。ただしC拡張では `rb_iv_get` と未時間甘えがついている。
使われる頻度の問題。なるほど。
Rodauth での説明。知らないけど。Deviseでも同じように長い名前がつけられていたな。

### 特別なメソッド名

- `to_proc` `&` で Proc 変換できる
- `call` `.()` で呼べるようになる
- `===` case when 式で使われる
- `[]` インデクサ

独自に使うのは、最後 `[]` しか使ったことない。->`ActiveHashExtentions`
- 短く書ける
- 説明的でないので、直感的でない記法は理解の妨げになる

## メソッド引数

「位置引数」という言葉は初めて聞いた。標準の言葉なのか？

> 引数が必要なのかどうか

すぐには意味が理解できなかった。
引数がないメソッドが実行速度は最速。実行速度の議論はもういい。

`dest` `src` の順序は昔からの課題ですよね。
`alias $dest = $source` みたいにかければよかったのに。
クラス名のエイリアスは、実際 定数の代入でいける。
`Foo = Bar`

> RUby の組み込みクラスでは、引数をきっかり２つ取るのは 2%。

こういうのは、Ruby だけの話ではない。
業務アプリ開発では仕様が複雑なものに対して実装することが多いので、
引数を少なくするのは限界がある。
メソッド分割していこうねという話？

キーワード引数と標準引数をどっちも使えるようにする方法。
```rb
def mmm(_x1 = nil, x1: _x1)
end
```

なるほど、面白いですね。わかりにくいですね。
ただ、リファクタリングの移行期などには使える手法かも。覚えておきます。

### オプショナル位置引数

これも初めて聞いた。
聞いたことのある言い方は「引数のデフォルト値」かな。

実用性の低そうなテーマだった。

### 可変長引数

TODO

### キーワード引数

TODO


## T (次週への申し送り)

- 読み方
  - 各節の末尾に まとめが書いてあるので、そこを読んでいく。
  - 詳しく知りたい内容だったら、本文を読む。
  - 上から順に読まない。
- アウトプット
  - 知らなかったことをまとめて書き出す。
- 不明点（調査項目）
  - みんなに質問したいこと
  - 自分で追加調査したいこと
